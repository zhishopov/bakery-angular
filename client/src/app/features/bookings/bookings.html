<h2>My Bookings</h2>

@if (serverError()) {
<p class="error">{{ serverError() }}</p>
} @if (successMessage()) {
<p class="success">{{ successMessage() }}</p>
} @if (loading()) {
<p>Loading…</p>
} @else if (bookings().length === 0) {
<p>No bookings yet.</p>
} @else {
<ul>
  @for (booking of bookings(); track booking._id) {
  <li>
    @if (editingId() === booking._id) {
    <form [formGroup]="editForm!" (ngSubmit)="saveEdit()">
      <input formControlName="name" placeholder="Name" />
      @if (editForm!.get('name')?.invalid && (editForm!.get('name')?.touched ||
      editForm!.get('name')?.dirty)) {
      <span class="field-error">Name is required (min 2).</span>
      }

      <input formControlName="email" placeholder="Email" type="email" />
      @if (editForm!.get('email')?.invalid && (editForm!.get('email')?.touched
      || editForm!.get('email')?.dirty)) {
      <span class="field-error">Valid email is required.</span>
      }

      <input formControlName="date" type="date" />
      @if (editForm!.get('date')?.invalid && (editForm!.get('date')?.touched ||
      editForm!.get('date')?.dirty)) {
      <span class="field-error">Date is required.</span>
      }

      <input formControlName="time" type="time" />
      @if (editForm!.get('time')?.invalid && (editForm!.get('time')?.touched ||
      editForm!.get('time')?.dirty)) {
      <span class="field-error">Time is required.</span>
      }

      <input formControlName="guests" type="number" min="1" />
      @if (editForm!.get('guests')?.invalid && (editForm!.get('guests')?.touched
      || editForm!.get('guests')?.dirty)) {
      <span class="field-error">Guests must be at least 1.</span>
      }

      <button
        type="submit"
        [disabled]="editForm!.invalid || actionLoadingId() === booking._id"
      >
        @if (actionLoadingId() === booking._id) { Saving… } @else { Save }
      </button>
      <button
        type="button"
        (click)="cancelEdit()"
        [disabled]="actionLoadingId() === booking._id"
      >
        Cancel
      </button>
    </form>
    } @else {
    <div>
      <strong>{{ booking.name }}</strong> • {{ booking.email }} •
      {{ booking.date }} {{ booking.time }} • Guests: {{ booking.guests }}
      <button
        type="button"
        (click)="startEdit(booking)"
        [disabled]="actionLoadingId() === booking._id"
      >
        Edit
      </button>
      <button
        type="button"
        (click)="deleteBooking(booking._id!)"
        [disabled]="actionLoadingId() === booking._id"
      >
        @if (actionLoadingId() === booking._id) { Deleting… } @else { Delete }
      </button>
    </div>
    }
  </li>
  }
</ul>
}
